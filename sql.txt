CREATE TABLE title(
titleid  MEDIUMINT UNSIGNED NOT NULL AUTO_INCREMENT,
title VARCHAR( 500 ) NOT NULL ,
PRIMARY KEY ( titleid )
)DEFAULT CHARSET=utf8;


CREATE TABLE permission(
permissionId  MEDIUMINT UNSIGNED NOT NULL AUTO_INCREMENT,
permissionName   VARCHAR( 50 ) NOT NULL,
PRIMARY KEY ( permissionId )
)DEFAULT CHARSET=utf8;


CREATE TABLE user(
userid MEDIUMINT UNSIGNED NOT NULL AUTO_INCREMENT,
username    VARCHAR( 30 )             NOT NULL,
password CHAR(40) NOT NULL,
firstname   VARCHAR(500)               NOT NULL,
lastname    VARCHAR(500)               NOT NULL,
signature   VARCHAR(500),
createdate  DATETIME   NOT NULL,
melicode    VARCHAR( 10 )             NOT NULL,
cellphone   VARCHAR( 11 ),
birthdate   VARCHAR( 30 )             NOT NULL,
address     VARCHAR(1000 )             NOT NULL,
lastlogin   VARCHAR(100)  ,
successor   MEDIUMINT UNSIGNED ,
PRIMARY KEY ( userid  )
)DEFAULT CHARSET=utf8;


CREATE TABLE contact(
contactid MEDIUMINT UNSIGNED NOT NULL AUTO_INCREMENT,
userid MEDIUMINT UNSIGNED NOT NULL,
firstname VARCHAR(500) NOT NULL,
lastname VARCHAR(500) NOT NULL,
cellphone VARCHAR(30),
email VARCHAR(30), 
tel VARCHAR(30) ,  
address VARCHAR(100),
groups VARCHAR(30) NOT NULL,
shared BINARY NOT NULL,         
PRIMARY KEY (contactid) ,
FOREIGN KEY (userid) REFERENCES user(userid)  ON DELETE CASCADE ON UPDATE CASCADE
)DEFAULT CHARSET=utf8;


CREATE TABLE userpermission(
userpermissionId  MEDIUMINT UNSIGNED NOT NULL AUTO_INCREMENT,
userid             MEDIUMINT  UNSIGNED          NOT NULL,
permissionid       MEDIUMINT   UNSIGNED         NOT NULL,
PRIMARY KEY ( userpermissionid  ),
FOREIGN KEY (userid) REFERENCES user(userid) ON DELETE CASCADE ON UPDATE CASCADE,
FOREIGN KEY (permissionid) REFERENCES permission(permissionid) ON DELETE CASCADE ON UPDATE CASCADE
)DEFAULT CHARSET=utf8;


CREATE TABLE groups(
groupid  MEDIUMINT UNSIGNED NOT NULL AUTO_INCREMENT,
groupname    VARCHAR( 30 )                NOT NULL,
PRIMARY KEY (groupid)
)DEFAULT CHARSET=utf8;

CREATE TABLE grouppermission(
grouppermissionid  MEDIUMINT UNSIGNED NOT NULL AUTO_INCREMENT,
groupid              MEDIUMINT   UNSIGNED         NOT NULL, 
permissionid         MEDIUMINT    UNSIGNED        NOT NULL, 
PRIMARY KEY (grouppermissionid),
FOREIGN KEY (permissionid) REFERENCES permission(permissionid) ON DELETE CASCADE ON UPDATE CASCADE,
FOREIGN KEY (groupid) REFERENCES groups(groupid) ON DELETE CASCADE ON UPDATE CASCADE
)DEFAULT CHARSET=utf8;


CREATE TABLE usergroup(
usergroupid  MEDIUMINT UNSIGNED NOT NULL AUTO_INCREMENT,
groupid      MEDIUMINT   UNSIGNED           NOT NULL,
userid       MEDIUMINT    UNSIGNED          NOT NULL, 
PRIMARY KEY (usergroupid),
FOREIGN KEY (groupid) REFERENCES groups(groupid) ON DELETE CASCADE ON UPDATE CASCADE,
FOREIGN KEY (userid)  REFERENCES  user(userid) ON DELETE CASCADE ON UPDATE CASCADE
)DEFAULT CHARSET=utf8;


CREATE TABLE usertitle(
titleid  MEDIUMINT UNSIGNED NOT NULL AUTO_INCREMENT,
userid       MEDIUMINT  UNSIGNED           NOT NULL, 
usertitleid  MEDIUMINT   UNSIGNED            NOT NULL,
PRIMARY KEY (usertitleid),
FOREIGN KEY (titleid) REFERENCES title(titleid) ON DELETE CASCADE ON UPDATE CASCADE,
FOREIGN KEY (userid) REFERENCES user(userid) ON DELETE CASCADE ON UPDATE CASCADE
)DEFAULT CHARSET=utf8;


CREATE TABLE letter(
letterid MEDIUMINT UNSIGNED NOT NULL AUTO_INCREMENT,
usertitle      MEDIUMINT  UNSIGNED          NOT NULL,
userid         MEDIUMINT   UNSIGNED           NOT NULL,
parentletterid MEDIUMINT  UNSIGNED,
letternumber   VARCHAR( 50 )                NOT NULL,
date           DATETIME  NOT NULL,
fromuser           VARCHAR( 30 )                NOT NULL,
touser             VARCHAR( 30 )                NOT NULL,
type           VARCHAR( 30 )                NOT NULL,
subject        VARCHAR( 30 )                NOT NULL,
mainText       VARCHAR( 30 )                NOT NULL,
attachment     VARCHAR( 30 )               ,
status         VARCHAR( 30 )                NOT NULL,
hasattachment  BINARY 					NOT NULL,
eghdam         VARCHAR( 30 )                NOT NULL,
PRIMARY KEY (letterid),
FOREIGN KEY (userid) REFERENCES user(userid) ON DELETE CASCADE ON UPDATE CASCADE
)DEFAULT CHARSET=utf8;


CREATE TABLE receivers(
receiverid  MEDIUMINT UNSIGNED NOT NULL AUTO_INCREMENT,
userid          MEDIUMINT   UNSIGNED        NOT NULL,
letterid        MEDIUMINT    UNSIGNED          NOT NULL, 
receivertype    VARCHAR( 100 )                NOT NULL,
viewed            BINARY	NOT NULL,
PRIMARY KEY (receiverid),
FOREIGN KEY (userid) REFERENCES user(userid) ON DELETE CASCADE ON UPDATE CASCADE,
FOREIGN KEY (letterid) REFERENCES letter(letterid) ON DELETE CASCADE ON UPDATE CASCADE
)DEFAULT CHARSET=utf8;


CREATE TABLE attachment(
attachmentid MEDIUMINT UNSIGNED NOT NULL AUTO_INCREMENT,
letterid         MEDIUMINT  UNSIGNED            NOT NULL,
filename         VARCHAR( 30 )                NOT NULL,
address          VARCHAR( 30 )                NOT NULL,
filesize         VARCHAR( 30 )                NOT NULL,
PRIMARY KEY (attachmentid),
FOREIGN KEY (letterid) REFERENCES letter(letterid) ON DELETE CASCADE ON UPDATE CASCADE
)DEFAULT CHARSET=utf8;
