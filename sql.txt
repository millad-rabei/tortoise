CREATE TABLE title(
titleid  MEDIUMINT UNSIGNED NOT NULL AUTO_INCREMENT,
title VARCHAR( 500 ) NOT NULL ,
PRIMARY KEY ( titleid )
)DEFAULT CHARSET=utf8;


CREATE TABLE Permission(
permissionId  MEDIUMINT UNSIGNED NOT NULL AUTO_INCREMENT,
permissionName   VARCHAR( 50 ) NOT NULL,
PRIMARY KEY ( permissionId )
)DEFAULT CHARSET=utf8;


CREATE TABLE User(
userId MEDIUMINT UNSIGNED NOT NULL AUTO_INCREMENT,
userName    VARCHAR( 30 )             NOT NULL,
password CHAR(40) NOT NULL,
FirstName   VARCHAR(500)               NOT NULL,
LastName    VARCHAR(500)               NOT NULL,
signature   VARCHAR(500),
createDate  DATETIME   NOT NULL,
meliCode    VARCHAR( 10 )             NOT NULL,
cellPhone   VARCHAR( 11 ),
birthDate   VARCHAR( 30 )             NOT NULL,
address     VARCHAR(1000 )             NOT NULL,
lastLogin   DATETIME  ,
successor   MEDIUMINT UNSIGNED ,
PRIMARY KEY ( userId  )
)DEFAULT CHARSET=utf8;


CREATE TABLE contact(
contactId MEDIUMINT UNSIGNED NOT NULL AUTO_INCREMENT,
userId MEDIUMINT UNSIGNED NOT NULL,
FirstName VARCHAR(500) NOT NULL,
LastName VARCHAR(500) NOT NULL,
cellPhone VARCHAR(30),
email VARCHAR(30), 
tel VARCHAR(30) ,  
address VARCHAR(100),
groups VARCHAR(30) NOT NULL,
shared BINARY NOT NULL,         
PRIMARY KEY ( contactId ) ,
FOREIGN KEY (userId) REFERENCES User(userId)  ON DELETE CASCADE ON UPDATE CASCADE
)DEFAULT CHARSET=utf8;


CREATE TABLE UserPermission(
UserPermissionId  MEDIUMINT UNSIGNED NOT NULL AUTO_INCREMENT,
UserId             MEDIUMINT  UNSIGNED          NOT NULL,
PermissionId       MEDIUMINT   UNSIGNED         NOT NULL,
PRIMARY KEY ( UserPermissionId  ),
FOREIGN KEY (userId) REFERENCES User(userId) ON DELETE CASCADE ON UPDATE CASCADE,
FOREIGN KEY (PermissionId) REFERENCES Permission(permissionId) ON DELETE CASCADE ON UPDATE CASCADE
)DEFAULT CHARSET=utf8;


CREATE TABLE groups(
groupId  MEDIUMINT UNSIGNED NOT NULL AUTO_INCREMENT,
groupName    VARCHAR( 30 )                NOT NULL,
PRIMARY KEY (groupId)
)DEFAULT CHARSET=utf8;

CREATE TABLE GroupPermission(
groupPermissionId  MEDIUMINT UNSIGNED NOT NULL AUTO_INCREMENT,
groupId              MEDIUMINT   UNSIGNED         NOT NULL, 
permissionId         MEDIUMINT    UNSIGNED        NOT NULL, 
PRIMARY KEY ( groupPermissionId  ),
FOREIGN KEY (permissionId) REFERENCES Permission(permissionId) ON DELETE CASCADE ON UPDATE CASCADE,
FOREIGN KEY (groupId) REFERENCES Groups(groupId) ON DELETE CASCADE ON UPDATE CASCADE
)DEFAULT CHARSET=utf8;


CREATE TABLE UserGroup(
UserGroupId  MEDIUMINT UNSIGNED NOT NULL AUTO_INCREMENT,
groupId      MEDIUMINT   UNSIGNED           NOT NULL,
userId       MEDIUMINT    UNSIGNED          NOT NULL, 
PRIMARY KEY (UserGroupId),
FOREIGN KEY (groupId ) REFERENCES Groups(groupId ) ON DELETE CASCADE ON UPDATE CASCADE,
FOREIGN KEY (userId )  REFERENCES  User(userId ) ON DELETE CASCADE ON UPDATE CASCADE
)DEFAULT CHARSET=utf8;


CREATE TABLE UserTitle(
TitleId  MEDIUMINT UNSIGNED NOT NULL AUTO_INCREMENT,
userId       MEDIUMINT  UNSIGNED           NOT NULL, 
userTitleId  MEDIUMINT   UNSIGNED            NOT NULL,
PRIMARY KEY (userTitleId),
FOREIGN KEY (TitleId ) REFERENCES Title(titleId ) ON DELETE CASCADE ON UPDATE CASCADE,
FOREIGN KEY (userId) REFERENCES User(userId ) ON DELETE CASCADE ON UPDATE CASCADE
)DEFAULT CHARSET=utf8;


CREATE TABLE Letter(
letterId MEDIUMINT UNSIGNED NOT NULL AUTO_INCREMENT,
userTitle      MEDIUMINT  UNSIGNED          NOT NULL,
userId         MEDIUMINT   UNSIGNED           NOT NULL,
parentLetterId MEDIUMINT  UNSIGNED,
LetterNumber   VARCHAR( 50 )                NOT NULL,
date           DATETIME  NOT NULL,
fromUser           VARCHAR( 30 )                NOT NULL,
toUser             VARCHAR( 30 )                NOT NULL,
type           VARCHAR( 30 )                NOT NULL,
subject        VARCHAR( 30 )                NOT NULL,
mainText       VARCHAR( 30 )                NOT NULL,
attachment     VARCHAR( 30 )               ,
status         VARCHAR( 30 )                NOT NULL,
hasAttachment  BINARY 					NOT NULL,
eghdam         VARCHAR( 30 )                NOT NULL,
PRIMARY KEY ( letterId  ),
FOREIGN KEY (userId) REFERENCES User(userId ) ON DELETE CASCADE ON UPDATE CASCADE
)DEFAULT CHARSET=utf8;


CREATE TABLE Receivers(
receiverId  MEDIUMINT UNSIGNED NOT NULL AUTO_INCREMENT,
userId          MEDIUMINT   UNSIGNED        NOT NULL,
LetterId        MEDIUMINT    UNSIGNED          NOT NULL, 
receiverType    VARCHAR( 100 )                NOT NULL,
viewed            BINARY	NOT NULL,
PRIMARY KEY ( receiverId  ),
FOREIGN KEY (userId) REFERENCES User(userId ) ON DELETE CASCADE ON UPDATE CASCADE,
FOREIGN KEY (LetterId ) REFERENCES Letter(letterId ) ON DELETE CASCADE ON UPDATE CASCADE
)DEFAULT CHARSET=utf8;


CREATE TABLE Attachment(
attachmentId MEDIUMINT UNSIGNED NOT NULL AUTO_INCREMENT,
letterId         MEDIUMINT  UNSIGNED            NOT NULL,
fileName         VARCHAR( 30 )                NOT NULL,
address          VARCHAR( 30 )                NOT NULL,
fileSize         VARCHAR( 30 )                NOT NULL,
PRIMARY KEY ( attachmentId  ),
FOREIGN KEY (letterId ) REFERENCES Letter(letterId ) ON DELETE CASCADE ON UPDATE CASCADE
)DEFAULT CHARSET=utf8;
